(function(S,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(S=typeof globalThis<"u"?globalThis:S||self,r(S["vue3-treeselect"]={},S.Vue))})(this,function(S,r){"use strict";var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ke(e,t){var n=t.length,s=e.length;if(s>n)return!1;if(s===n)return e===t;e:for(var i=0,o=0;i<s;i++){for(var a=e.charCodeAt(i);o<n;)if(t.charCodeAt(o++)===a)continue e;return!1}return!0}var Ue=Ke;const qe=w(Ue);function Ye(){}var Xe=Ye;const Ge=w(Xe),N=process.env.NODE_ENV==="production"?Ge:function(t,n){if(!t()){const s=["[Vue-Treeselect Warning]"].concat(n());console.warn(...s)}};function L(e){return function(n,...s){n.type==="mousedown"&&n.button===0&&e.call(this,n,...s)}}function Je(e,t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect(),i=t.offsetHeight/3;s.bottom+i>n.bottom?e.scrollTop=Math.min(t.offsetTop+t.clientHeight-e.offsetHeight+i,e.scrollHeight):s.top-i<n.top&&(e.scrollTop=Math.max(t.offsetTop-i,0))}function Ze(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ie=Ze,et=typeof B=="object"&&B&&B.Object===Object&&B,tt=et,nt=tt,st=typeof self=="object"&&self&&self.Object===Object&&self,it=nt||st||Function("return this")(),re=it,rt=re,ot=function(){return rt.Date.now()},at=ot,lt=/\s/;function ct(e){for(var t=e.length;t--&&lt.test(e.charAt(t)););return t}var dt=ct,ut=dt,ht=/^\s+/;function ft(e){return e&&e.slice(0,ut(e)+1).replace(ht,"")}var pt=ft,mt=re,gt=mt.Symbol,oe=gt,ae=oe,le=Object.prototype,St=le.hasOwnProperty,Ot=le.toString,I=ae?ae.toStringTag:void 0;function bt(e){var t=St.call(e,I),n=e[I];try{e[I]=void 0;var s=!0}catch{}var i=Ot.call(e);return s&&(t?e[I]=n:delete e[I]),i}var yt=bt,Nt=Object.prototype,vt=Nt.toString;function _t(e){return vt.call(e)}var Et=_t,ce=oe,Ct=yt,wt=Et,Lt="[object Null]",Tt="[object Undefined]",de=ce?ce.toStringTag:void 0;function Mt(e){return e==null?e===void 0?Tt:Lt:de&&de in Object(e)?Ct(e):wt(e)}var Vt=Mt;function It(e){return e!=null&&typeof e=="object"}var Dt=It,xt=Vt,Rt=Dt,At="[object Symbol]";function $t(e){return typeof e=="symbol"||Rt(e)&&xt(e)==At}var Bt=$t,kt=pt,ue=ie,zt=Bt,he=NaN,Ft=/^[-+]0x[0-9a-f]+$/i,Ht=/^0b[01]+$/i,Wt=/^0o[0-7]+$/i,Pt=parseInt;function jt(e){if(typeof e=="number")return e;if(zt(e))return he;if(ue(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ue(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=kt(e);var n=Ht.test(e);return n||Wt.test(e)?Pt(e.slice(2),n?2:8):Ft.test(e)?he:+e}var fe=jt,Qt=ie,P=at,pe=fe,Kt="Expected a function",Ut=Math.max,qt=Math.min;function Yt(e,t,n){var s,i,o,a,c,u,d=0,g=!1,h=!1,b=!0;if(typeof e!="function")throw new TypeError(Kt);t=pe(t)||0,Qt(n)&&(g=!!n.leading,h="maxWait"in n,o=h?Ut(pe(n.maxWait)||0,t):o,b="trailing"in n?!!n.trailing:b);function M(p){var C=s,$=i;return s=i=void 0,d=p,a=e.apply($,C),a}function A(p){return d=p,c=setTimeout(_,t),g?M(p):a}function F(p){var C=p-u,$=p-d,Qe=t-C;return h?qt(Qe,o-$):Qe}function H(p){var C=p-u,$=p-d;return u===void 0||C>=t||C<0||h&&$>=o}function _(){var p=P();if(H(p))return W(p);c=setTimeout(_,F(p))}function W(p){return c=void 0,b&&s?M(p):(s=i=void 0,a)}function l(){c!==void 0&&clearTimeout(c),d=0,s=u=i=c=void 0}function f(){return c===void 0?a:W(P())}function E(){var p=P(),C=H(p);if(s=arguments,i=this,u=p,C){if(c===void 0)return A(u);if(h)return clearTimeout(c),c=setTimeout(_,t),M(u)}return c===void 0&&(c=setTimeout(_,t)),a}return E.cancel=l,E.flush=f,E}var Xt=Yt;const Gt=w(Xt);var Jt=function(e,t){var n=document.createElement("_"),s=n.appendChild(document.createElement("_")),i=n.appendChild(document.createElement("_")),o=s.appendChild(document.createElement("_")),a=void 0,c=void 0;return s.style.cssText=n.style.cssText="height:100%;left:0;opacity:0;overflow:hidden;pointer-events:none;position:absolute;top:0;transition:0s;width:100%;z-index:-1",o.style.cssText=i.style.cssText="display:block;height:100%;transition:0s;width:100%",o.style.width=o.style.height="200%",e.appendChild(n),u(),g;function u(){d();var h=e.offsetWidth,b=e.offsetHeight;(h!==a||b!==c)&&(a=h,c=b,i.style.width=h*2+"px",i.style.height=b*2+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,t({width:h,height:b})),s.addEventListener("scroll",u),n.addEventListener("scroll",u)}function d(){s.removeEventListener("scroll",u),n.removeEventListener("scroll",u)}function g(){d(),e.removeChild(n)}};function me(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}let j;const k=[],Zt=100;function en(){j=setInterval(()=>{k.forEach(ge)},Zt)}function tn(){clearInterval(j),j=null}function ge(e){const{$el:t,listener:n,lastWidth:s,lastHeight:i}=e,o=t.offsetWidth,a=t.offsetHeight;(s!==o||i!==a)&&(e.lastWidth=o,e.lastHeight=a,n({width:o,height:a}))}function nn(e,t){const n={$el:e,listener:t,lastWidth:null,lastHeight:null},s=()=>{me(k,n),k.length||tn()};return k.push(n),ge(n),en(),s}function Se(e,t){const n=document.documentMode===9;let s=!0;const a=(n?nn:Jt)(e,(...c)=>s||t(...c));return s=!1,a}function sn(e){const t=[];let n=e.parentNode;for(;n&&n.nodeName!=="BODY"&&n.nodeType===document.ELEMENT_NODE;)rn(n)&&t.push(n),n=n.parentNode;return t.push(window),t}function rn(e){const{overflow:t,overflowX:n,overflowY:s}=getComputedStyle(e);return/(auto|scroll|overlay)/.test(t+s+n)}function Oe(e,t){const n=sn(e);return window.addEventListener("resize",t,{passive:!0}),n.forEach(s=>{s.addEventListener("scroll",t,{passive:!0})}),function(){window.removeEventListener("resize",t,{passive:!0}),n.forEach(i=>{i.removeEventListener("scroll",t,{passive:!0})})}}function be(e){return e!==e}function ye(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}var on=fe,Ne=1/0,an=17976931348623157e292;function ln(e){if(!e)return e===0?e:0;if(e=on(e),e===Ne||e===-Ne){var t=e<0?-1:1;return t*an}return e===e?e:0}var cn=ln,dn=cn;function un(e){var t=dn(e),n=t%1;return t===t?n?t-n:t:0}var hn=un,fn=hn,pn="Expected a function";function mn(e,t){var n;if(typeof t!="function")throw new TypeError(pn);return e=fn(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var gn=mn,Sn=gn;function On(e){return Sn(2,e)}var bn=On;const yn=w(bn);function Nn(e){return e}var vn=Nn;const _n=w(vn);function En(e){return function(){return e}}var Cn=En;const ve=w(Cn),O=()=>Object.create(null);function _e(e){return e==null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype}function wn(e,t,n){_e(n)?(e[t]||(e[t]={}),Q(e[t],n)):e[t]=n}function Q(e,t){if(_e(t)){const n=Object.keys(t);for(let s=0,i=n.length;s<i;s++)wn(e,n[s],t[n[s]])}return e}function Ln(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Tn=Ln;const Ee=w(Tn);function v(e,t){return e.indexOf(t)!==-1}function Ce(e,t,n){for(let s=0,i=e.length;s<i;s++)if(t.call(n,e[s],s,e))return e[s]}function K(e,t){if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!0;return!1}const T=null,U=0,we=1,Le=2,V="ALL_CHILDREN",D="ALL_DESCENDANTS",x="LEAF_CHILDREN",R="LEAF_DESCENDANTS",Te="LOAD_ROOT_OPTIONS",Me="LOAD_CHILDREN_OPTIONS",Ve="ASYNC_SEARCH",q="ALL",z="BRANCH_PRIORITY",Y="LEAF_PRIORITY",X="ALL_WITH_INDETERMINATE",Ie="ORDER_SELECTED",De="LEVEL",xe="INDEX",m={BACKSPACE:8,ENTER:13,ESCAPE:27,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},Mn=process.env.NODE_ENV==="testing"?10:200,Re=5,Ae=40;function $e(e,t){let n=0;do{if(e.level<n)return-1;if(t.level<n)return 1;if(e.index[n]!==t.index[n])return e.index[n]-t.index[n];n++}while(!0)}function Vn(e,t){return e.level===t.level?$e(e,t):e.level-t.level}function G(){return{isLoaded:!1,isLoading:!1,loadingError:""}}function In(e){return typeof e=="string"?e:typeof e=="number"&&!be(e)?e+"":""}function Be(e,t,n){return e?qe(t,n):v(n,t)}function J(e){return e.message||String(e)}let Dn=0;const ke={provide(){return{instance:this}},props:{allowClearingDisabled:{type:Boolean,default:!1},allowSelectingDisabledDescendants:{type:Boolean,default:!1},alwaysOpen:{type:Boolean,default:!1},appendToBody:{type:Boolean,default:!1},async:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!1},autoLoadRootOptions:{type:Boolean,default:!0},autoDeselectAncestors:{type:Boolean,default:!1},autoDeselectDescendants:{type:Boolean,default:!1},autoSelectAncestors:{type:Boolean,default:!1},autoSelectDescendants:{type:Boolean,default:!1},backspaceRemoves:{type:Boolean,default:!0},beforeClearAll:{type:Function,default:ve(!0)},branchNodesFirst:{type:Boolean,default:!1},cacheOptions:{type:Boolean,default:!0},clearable:{type:Boolean,default:!0},clearAllText:{type:String,default:"Clear all"},clearOnSelect:{type:Boolean,default:!1},clearValueText:{type:String,default:"Clear value"},closeOnSelect:{type:Boolean,default:!0},defaultExpandLevel:{type:Number,default:0},defaultOptions:{default:!1},deleteRemoves:{type:Boolean,default:!0},delimiter:{type:String,default:","},flattenSearchResults:{type:Boolean,default:!1},disableBranchNodes:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},disableFuzzyMatching:{type:Boolean,default:!1},flat:{type:Boolean,default:!1},instanceId:{default:()=>`${Dn++}$$`,type:[String,Number]},joinValues:{type:Boolean,default:!1},limit:{type:Number,default:1/0},limitText:{type:Function,default:function(t){return`and ${t} more`}},loadingText:{type:String,default:"Loading..."},loadOptions:{type:Function},matchKeys:{type:Array,default:ve(["label"])},maxHeight:{type:Number,default:300},multiple:{type:Boolean,default:!1},name:{type:String},noChildrenText:{type:String,default:"No sub-options."},noOptionsText:{type:String,default:"No options available."},noResultsText:{type:String,default:"No results found..."},normalizer:{type:Function,default:_n},openDirection:{type:String,default:"auto",validator(e){return v(["auto","top","bottom","above","below"],e)}},openOnClick:{type:Boolean,default:!0},openOnFocus:{type:Boolean,default:!1},options:{type:Array},placeholder:{type:String,default:"Select..."},required:{type:Boolean,default:!1},retryText:{type:String,default:"Retry?"},retryTitle:{type:String,default:"Click to retry"},searchable:{type:Boolean,default:!0},searchNested:{type:Boolean,default:!1},searchPromptText:{type:String,default:"Type to search..."},showCount:{type:Boolean,default:!1},showCountOf:{type:String,default:V,validator(e){return v([V,D,x,R],e)}},showCountOnSearch:null,sortValueBy:{type:String,default:Ie,validator(e){return v([Ie,De,xe],e)}},tabIndex:{type:Number,default:0},modelValue:null,valueConsistsOf:{type:String,default:z,validator(e){return v([q,z,Y,X],e)}},valueFormat:{type:String,default:"id"},zIndex:{type:[Number,String],default:999}},data(){return{trigger:{isFocused:!1,searchQuery:""},menu:{isOpen:!1,current:null,lastScrollPosition:0,placement:"bottom"},forest:{normalizedOptions:[],nodeMap:O(),checkedStateMap:O(),selectedNodeIds:this.extractCheckedNodeIdsFromValue(),selectedNodeMap:O()},rootOptionsStates:G(),localSearch:{active:!1,noResults:!0,countMap:O()},remoteSearch:O()}},computed:{selectedNodes(){return this.forest.selectedNodeIds.map(this.getNode)},internalValue(){let e;if(this.single||this.flat||this.disableBranchNodes||this.valueConsistsOf===q)e=this.forest.selectedNodeIds.slice();else if(this.valueConsistsOf===z)e=this.forest.selectedNodeIds.filter(t=>{const n=this.getNode(t);return n.isRootNode?!0:!this.isSelected(n.parentNode)});else if(this.valueConsistsOf===Y)e=this.forest.selectedNodeIds.filter(t=>{const n=this.getNode(t);return n.isLeaf?!0:n.children.length===0});else if(this.valueConsistsOf===X){const t=[];e=this.forest.selectedNodeIds.slice(),this.selectedNodes.forEach(n=>{n.ancestors.forEach(s=>{v(t,s.id)||v(e,s.id)||t.push(s.id)})}),e.push(...t)}return this.sortValueBy===De?e.sort((t,n)=>Vn(this.getNode(t),this.getNode(n))):this.sortValueBy===xe&&e.sort((t,n)=>$e(this.getNode(t),this.getNode(n))),e},hasValue(){return this.internalValue.length>0},single(){return!this.multiple},visibleOptionIds(){const e=[];return this.traverseAllNodesByIndex(t=>{if((!this.localSearch.active||this.shouldOptionBeIncludedInSearchResult(t))&&e.push(t.id),t.isBranch&&!this.shouldExpand(t))return!1}),e},hasVisibleOptions(){return this.visibleOptionIds.length!==0},showCountOnSearchComputed(){return typeof this.showCountOnSearch=="boolean"?this.showCountOnSearch:this.showCount},hasBranchNodes(){return this.forest.normalizedOptions.some(e=>e.isBranch)},shouldFlattenOptions(){return this.localSearch.active&&this.flattenSearchResults}},watch:{alwaysOpen(e){e?this.openMenu():this.closeMenu()},branchNodesFirst(){this.initialize()},disabled(e){e&&this.menu.isOpen?this.closeMenu():!e&&!this.menu.isOpen&&this.alwaysOpen&&this.openMenu()},flat(){this.initialize()},internalValue(e,t){K(e,t)&&this.$emit("update:modelValue",this.getValue(),this.getInstanceId())},matchKeys(){this.initialize()},multiple(e){e&&this.buildForestState()},options:{handler(){this.async||(this.initialize(),this.rootOptionsStates.isLoaded=Array.isArray(this.options))},deep:!0,immediate:!0},"trigger.searchQuery"(){this.async?this.handleRemoteSearch():this.handleLocalSearch(),this.$emit("search-change",this.trigger.searchQuery,this.getInstanceId())},value(){const e=this.extractCheckedNodeIdsFromValue();K(e,this.internalValue)&&this.fixSelectedNodeIds(e)}},methods:{verifyProps(){N(()=>this.async?this.searchable:!0,()=>'For async search mode, the value of "searchable" prop must be true.'),this.options==null&&!this.loadOptions&&N(()=>!1,()=>'Are you meant to dynamically load options? You need to use "loadOptions" prop.'),this.flat&&N(()=>this.multiple,()=>'You are using flat mode. But you forgot to add "multiple=true"?'),this.flat||["autoSelectAncestors","autoSelectDescendants","autoDeselectAncestors","autoDeselectDescendants"].forEach(t=>{N(()=>!this[t],()=>`"${t}" only applies to flat mode.`)})},resetFlags(){this._blurOnSelect=!1},initialize(){const e=this.async?this.getRemoteSearchEntry().options:this.options;if(Array.isArray(e)){const t=this.forest.nodeMap;this.forest.nodeMap=O(),this.keepDataOfSelectedNodes(t),this.forest.normalizedOptions=this.normalize(T,e,t),this.fixSelectedNodeIds(this.internalValue)}else this.forest.normalizedOptions=[]},getInstanceId(){return this.instanceId==null?this.id:this.instanceId},getValue(){if(this.valueFormat==="id")return this.multiple?this.internalValue.slice():this.internalValue[0];const e=this.internalValue.map(t=>this.getNode(t).raw);return this.multiple?e:e[0]},getNode(e){return N(()=>e!=null,()=>`Invalid node id: ${e}`),e==null?null:e in this.forest.nodeMap?this.forest.nodeMap[e]:this.createFallbackNode(e)},createFallbackNode(e){const t=this.extractNodeFromValue(e),n=this.enhancedNormalizer(t).label||`${e} (unknown)`,s={id:e,label:n,ancestors:[],parentNode:T,isFallbackNode:!0,isRootNode:!0,isLeaf:!0,isBranch:!1,isDisabled:!1,isNew:!1,index:[-1],level:0,raw:t};return this.forest.nodeMap[e]=s},extractCheckedNodeIdsFromValue(){return this.modelValue==null?[]:this.valueFormat==="id"?this.multiple?this.modelValue.slice():[this.modelValue]:(this.multiple?this.modelValue:[this.modelValue]).map(e=>this.enhancedNormalizer(e)).map(e=>e.id)},extractNodeFromValue(e){const t={id:e};if(this.valueFormat==="id")return t;const n=this.multiple?Array.isArray(this.modelValue)?this.modelValue:[]:this.modelValue?[this.modelValue]:[];return Ce(n,i=>i&&this.enhancedNormalizer(i).id===e)||t},fixSelectedNodeIds(e){let t=[];if(this.single||this.flat||this.disableBranchNodes||this.valueConsistsOf===q)t=e;else if(this.valueConsistsOf===z)e.forEach(s=>{t.push(s);const i=this.getNode(s);i.isBranch&&this.traverseDescendantsBFS(i,o=>{t.push(o.id)})});else if(this.valueConsistsOf===Y){const s=O(),i=e.slice();for(;i.length;){const o=i.shift(),a=this.getNode(o);t.push(o),!a.isRootNode&&(a.parentNode.id in s||(s[a.parentNode.id]=a.parentNode.children.length),--s[a.parentNode.id]===0&&i.push(a.parentNode.id))}}else if(this.valueConsistsOf===X){const s=O(),i=e.filter(o=>{const a=this.getNode(o);return a.isLeaf||a.children.length===0});for(;i.length;){const o=i.shift(),a=this.getNode(o);t.push(o),!a.isRootNode&&(a.parentNode.id in s||(s[a.parentNode.id]=a.parentNode.children.length),--s[a.parentNode.id]===0&&i.push(a.parentNode.id))}}K(this.forest.selectedNodeIds,t)&&(this.forest.selectedNodeIds=t),this.buildForestState()},keepDataOfSelectedNodes(e){this.forest.selectedNodeIds.forEach(t=>{if(!e[t])return;const n={...e[t],isFallbackNode:!0};this.forest.nodeMap[t]=n})},isSelected(e){return this.forest.selectedNodeMap[e.id]===!0},traverseDescendantsBFS(e,t){if(!e.isBranch)return;const n=e.children.slice();for(;n.length;){const s=n[0];s.isBranch&&n.push(...s.children),t(s),n.shift()}},traverseDescendantsDFS(e,t){e.isBranch&&e.children.forEach(n=>{this.traverseDescendantsDFS(n,t),t(n)})},traverseAllNodesDFS(e){this.forest.normalizedOptions.forEach(t=>{this.traverseDescendantsDFS(t,e),e(t)})},traverseAllNodesByIndex(e){const t=n=>{n.children.forEach(s=>{e(s)!==!1&&s.isBranch&&t(s)})};t({children:this.forest.normalizedOptions})},toggleClickOutsideEvent(e){e?document.addEventListener("mousedown",this.handleClickOutside,!1):document.removeEventListener("mousedown",this.handleClickOutside,!1)},getValueContainer(){return this.$refs.control.$refs["value-container"]},getInput(){return this.getValueContainer().$refs.input},focusInput(){this.getInput().focus()},blurInput(){this.getInput().blur()},handleMouseDown:L(function(t){if(t.preventDefault(),t.stopPropagation(),this.disabled)return;this.getValueContainer().$el.contains(t.target)&&!this.menu.isOpen&&(this.openOnClick||this.trigger.isFocused)&&this.openMenu(),this._blurOnSelect?this.blurInput():this.focusInput(),this.resetFlags()}),handleClickOutside(e){this.$refs.wrapper&&!this.$refs.wrapper.contains(e.target)&&(this.blurInput(),this.closeMenu())},handleLocalSearch(){const{searchQuery:e}=this.trigger,t=()=>this.resetHighlightedOptionWhenNecessary(!0);if(!e)return this.localSearch.active=!1,t();this.localSearch.active=!0,this.localSearch.noResults=!0,this.traverseAllNodesDFS(i=>{i.isBranch&&(i.isExpandedOnSearch=!1,i.showAllChildrenOnSearch=!1,i.isMatched=!1,i.hasMatchedDescendants=!1,this.localSearch.countMap[i.id]={[V]:0,[D]:0,[x]:0,[R]:0})});const n=e.trim().toLocaleLowerCase(),s=n.replace(/\s+/g," ").split(" ");this.traverseAllNodesDFS(i=>{this.searchNested&&s.length>1?i.isMatched=s.every(o=>Be(!1,o,i.nestedSearchLabel)):i.isMatched=this.matchKeys.some(o=>Be(!this.disableFuzzyMatching,n,i.lowerCased[o])),i.isMatched&&(this.localSearch.noResults=!1,i.ancestors.forEach(o=>this.localSearch.countMap[o.id][D]++),i.isLeaf&&i.ancestors.forEach(o=>this.localSearch.countMap[o.id][R]++),i.parentNode!==T&&(this.localSearch.countMap[i.parentNode.id][V]+=1,i.isLeaf&&(this.localSearch.countMap[i.parentNode.id][x]+=1))),(i.isMatched||i.isBranch&&i.isExpandedOnSearch)&&i.parentNode!==T&&(i.parentNode.isExpandedOnSearch=!0,i.parentNode.hasMatchedDescendants=!0)}),t()},handleRemoteSearch(){const{searchQuery:e}=this.trigger,t=this.getRemoteSearchEntry(),n=()=>{this.initialize(),this.resetHighlightedOptionWhenNecessary(!0)};if((e===""||this.cacheOptions)&&t.isLoaded)return n();this.callLoadOptionsProp({action:Ve,args:{searchQuery:e},isPending(){return t.isLoading},start:()=>{t.isLoading=!0,t.isLoaded=!1,t.loadingError=""},succeed:s=>{t.isLoaded=!0,t.options=s,this.trigger.searchQuery===e&&n()},fail:s=>{t.loadingError=J(s)},end:()=>{t.isLoading=!1}})},getRemoteSearchEntry(){const{searchQuery:e}=this.trigger,t=this.remoteSearch[e]||{...G(),options:[]};if(this.$watch(()=>t.options,()=>{this.trigger.searchQuery===e&&this.initialize()},{deep:!0}),e===""){if(Array.isArray(this.defaultOptions))return t.options=this.defaultOptions,t.isLoaded=!0,t;if(this.defaultOptions!==!0)return t.isLoaded=!0,t}return this.remoteSearch[e]||(this.remoteSearch[e]=t),t},shouldExpand(e){return this.localSearch.active?e.isExpandedOnSearch:e.isExpanded},shouldOptionBeIncludedInSearchResult(e){return!!(e.isMatched||e.isBranch&&e.hasMatchedDescendants&&!this.flattenSearchResults||!e.isRootNode&&e.parentNode.showAllChildrenOnSearch)},shouldShowOptionInMenu(e){return!(this.localSearch.active&&!this.shouldOptionBeIncludedInSearchResult(e))},getControl(){return this.$refs.control.$el},getMenu(){const t=(this.appendToBody?this.$refs.portal.portalTarget:this).$refs.menu.$refs.menu;return t&&t.nodeName!=="#comment"?t:null},setCurrentHighlightedOption(e,t=!0){const n=this.menu.current;if(n!=null&&n in this.forest.nodeMap&&(this.forest.nodeMap[n].isHighlighted=!1),this.menu.current=e.id,e.isHighlighted=!0,this.menu.isOpen&&t){const s=()=>{const i=this.getMenu(),o=i.querySelector(`.vue-treeselect__option[data-id="${e.id}"]`);o&&Je(i,o)};this.getMenu()?s():this.$nextTick(s)}},resetHighlightedOptionWhenNecessary(e=!1){const{current:t}=this.menu;(e||t==null||!(t in this.forest.nodeMap)||!this.shouldShowOptionInMenu(this.getNode(t)))&&this.highlightFirstOption()},highlightFirstOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds[0];this.setCurrentHighlightedOption(this.getNode(e))},highlightPrevOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds.indexOf(this.menu.current)-1;if(e===-1)return this.highlightLastOption();this.setCurrentHighlightedOption(this.getNode(this.visibleOptionIds[e]))},highlightNextOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds.indexOf(this.menu.current)+1;if(e===this.visibleOptionIds.length)return this.highlightFirstOption();this.setCurrentHighlightedOption(this.getNode(this.visibleOptionIds[e]))},highlightLastOption(){if(!this.hasVisibleOptions)return;const e=Ee(this.visibleOptionIds);this.setCurrentHighlightedOption(this.getNode(e))},resetSearchQuery(){this.trigger.searchQuery=""},closeMenu(){!this.menu.isOpen||!this.disabled&&this.alwaysOpen||(this.saveMenuScrollPosition(),this.menu.isOpen=!1,this.toggleClickOutsideEvent(!1),this.resetSearchQuery(),this.$emit("close",this.getValue(),this.getInstanceId()))},openMenu(){this.disabled||this.menu.isOpen||(this.menu.isOpen=!0,this.$nextTick(this.resetHighlightedOptionWhenNecessary),this.$nextTick(this.restoreMenuScrollPosition),!this.options&&!this.async&&this.loadRootOptions(),this.toggleClickOutsideEvent(!0),this.$emit("open",this.getInstanceId()))},toggleMenu(){this.menu.isOpen?this.closeMenu():this.openMenu()},toggleExpanded(e){let t;this.localSearch.active?(t=e.isExpandedOnSearch=!e.isExpandedOnSearch,t&&(e.showAllChildrenOnSearch=!0)):t=e.isExpanded=!e.isExpanded,t&&!e.childrenStates.isLoaded&&this.loadChildrenOptions(e)},buildForestState(){const e=O();this.forest.selectedNodeIds.forEach(n=>{e[n]=!0}),this.forest.selectedNodeMap=e;const t=O();this.multiple&&(this.traverseAllNodesByIndex(n=>{t[n.id]=U}),this.selectedNodes.forEach(n=>{t[n.id]=Le,!this.flat&&!this.disableBranchNodes&&n.ancestors.forEach(s=>{this.isSelected(s)||(t[s.id]=we)})})),this.forest.checkedStateMap=t},enhancedNormalizer(e){return{...e,...this.normalizer(e,this.getInstanceId())}},normalize(e,t,n){let s=t.map(i=>[this.enhancedNormalizer(i),i]).map(([i,o],a)=>{this.checkDuplication(i),this.verifyNodeShape(i);const{id:c,label:u,children:d,isDefaultExpanded:g}=i,h=e===T,b=h?0:e.level+1,M=Array.isArray(d)&&d.length||d===null,A=!M,F=!!i.isDisabled||!this.flat&&!h&&e.isDisabled,H=!!i.isNew,_=this.matchKeys.reduce((f,E)=>({...f,[E]:In(i[E]).toLocaleLowerCase()}),{}),W=h?_.label:e.nestedSearchLabel+" "+_.label;this.forest.nodeMap[c]=O();const l=this.forest.nodeMap[c];if(l.id=c,l.label=u,l.level=b,l.ancestors=h?[]:[e].concat(e.ancestors),l.index=(h?[]:e.index).concat(a),l.parentNode=e,l.lowerCased=_,l.nestedSearchLabel=W,l.isDisabled=F,l.isNew=H,l.isMatched=!1,l.isHighlighted=!1,l.isBranch=M,l.isLeaf=A,l.isRootNode=h,l.raw=o,M){const f=Array.isArray(d);l.childrenStates={...G(),isLoaded:f},l.isExpanded=typeof g=="boolean"?g:b<this.defaultExpandLevel,l.hasMatchedDescendants=!1,l.hasDisabledDescendants=!1,l.isExpandedOnSearch=!1,l.showAllChildrenOnSearch=!1,l.count={[V]:0,[D]:0,[x]:0,[R]:0},l.children=f?this.normalize(l,d,n):[],g===!0&&l.ancestors.forEach(E=>{E.isExpanded=!0}),!f&&typeof this.loadOptions!="function"?N(()=>!1,()=>'Unloaded branch node detected. "loadOptions" prop is required to load its children.'):!f&&l.isExpanded&&this.loadChildrenOptions(l)}if(l.ancestors.forEach(f=>f.count[D]++),A&&l.ancestors.forEach(f=>f.count[R]++),h||(e.count[V]+=1,A&&(e.count[x]+=1),F&&(e.hasDisabledDescendants=!0)),n&&n[c]){const f=n[c];l.isMatched=f.isMatched,l.showAllChildrenOnSearch=f.showAllChildrenOnSearch,l.isHighlighted=f.isHighlighted,f.isBranch&&l.isBranch&&(l.isExpanded=f.isExpanded,l.isExpandedOnSearch=f.isExpandedOnSearch,f.childrenStates.isLoaded&&!l.childrenStates.isLoaded?l.isExpanded=!1:l.childrenStates={...f.childrenStates})}return l});if(this.branchNodesFirst){const i=s.filter(a=>a.isBranch),o=s.filter(a=>a.isLeaf);s=i.concat(o)}return s},loadRootOptions(){this.callLoadOptionsProp({action:Te,isPending:()=>this.rootOptionsStates.isLoading,start:()=>{this.rootOptionsStates.isLoading=!0,this.rootOptionsStates.loadingError=""},succeed:()=>{this.rootOptionsStates.isLoaded=!0,this.$nextTick(()=>{this.resetHighlightedOptionWhenNecessary(!0)})},fail:e=>{this.rootOptionsStates.loadingError=J(e)},end:()=>{this.rootOptionsStates.isLoading=!1}})},loadChildrenOptions(e){const{id:t,raw:n}=e;this.callLoadOptionsProp({action:Me,args:{parentNode:n},isPending:()=>this.getNode(t).childrenStates.isLoading,start:()=>{this.getNode(t).childrenStates.isLoading=!0,this.getNode(t).childrenStates.loadingError=""},succeed:()=>{this.getNode(t).childrenStates.isLoaded=!0},fail:s=>{this.getNode(t).childrenStates.loadingError=J(s)},end:()=>{this.getNode(t).childrenStates.isLoading=!1}})},callLoadOptionsProp({action:e,args:t,isPending:n,start:s,succeed:i,fail:o,end:a}){if(!this.loadOptions||n())return;s();const c=yn((d,g)=>{d?o(d):i(g),a()}),u=this.loadOptions({id:this.getInstanceId(),instanceId:this.getInstanceId(),action:e,...t,callback:c});ye(u)&&u.then(()=>{c()},d=>{c(d)}).catch(d=>{console.error(d)})},checkDuplication(e){N(()=>!(e.id in this.forest.nodeMap&&!this.forest.nodeMap[e.id].isFallbackNode),()=>`Detected duplicate presence of node id ${JSON.stringify(e.id)}. Their labels are "${this.forest.nodeMap[e.id].label}" and "${e.label}" respectively.`)},verifyNodeShape(e){N(()=>!(e.children===void 0&&e.isBranch===!0),()=>"Are you meant to declare an unloaded branch node? `isBranch: true` is no longer supported, please use `children: null` instead.")},select(e){if(this.disabled||e.isDisabled)return;this.single&&this.clear();const t=this.multiple&&!this.flat?this.forest.checkedStateMap[e.id]===U:!this.isSelected(e);t?this._selectNode(e):this._deselectNode(e),this.buildForestState(),t?this.$emit("select",e.raw,this.getInstanceId()):this.$emit("deselect",e.raw,this.getInstanceId()),this.localSearch.active&&t&&(this.single||this.clearOnSelect)&&this.resetSearchQuery(),this.single&&this.closeOnSelect&&(this.closeMenu(),this.searchable&&(this._blurOnSelect=!0))},clear(){this.hasValue&&(this.single||this.allowClearingDisabled?this.forest.selectedNodeIds=[]:this.forest.selectedNodeIds=this.forest.selectedNodeIds.filter(e=>this.getNode(e).isDisabled),this.buildForestState())},_selectNode(e){if(this.single||this.disableBranchNodes)return this.addValue(e);if(this.flat){this.addValue(e),this.autoSelectAncestors?e.ancestors.forEach(n=>{!this.isSelected(n)&&!n.isDisabled&&this.addValue(n)}):this.autoSelectDescendants&&this.traverseDescendantsBFS(e,n=>{!this.isSelected(n)&&!n.isDisabled&&this.addValue(n)});return}const t=e.isLeaf||!e.hasDisabledDescendants||this.allowSelectingDisabledDescendants;if(t&&this.addValue(e),e.isBranch&&this.traverseDescendantsBFS(e,n=>{(!n.isDisabled||this.allowSelectingDisabledDescendants)&&this.addValue(n)}),t){let n=e;for(;(n=n.parentNode)!==T&&n.children.every(this.isSelected);)this.addValue(n)}},_deselectNode(e){if(this.disableBranchNodes)return this.removeValue(e);if(this.flat){this.removeValue(e),this.autoDeselectAncestors?e.ancestors.forEach(n=>{this.isSelected(n)&&!n.isDisabled&&this.removeValue(n)}):this.autoDeselectDescendants&&this.traverseDescendantsBFS(e,n=>{this.isSelected(n)&&!n.isDisabled&&this.removeValue(n)});return}let t=!1;if(e.isBranch&&this.traverseDescendantsDFS(e,n=>{(!n.isDisabled||this.allowSelectingDisabledDescendants)&&(this.removeValue(n),t=!0)}),e.isLeaf||t||e.children.length===0){this.removeValue(e);let n=e;for(;(n=n.parentNode)!==T&&this.isSelected(n);)this.removeValue(n)}},addValue(e){this.forest.selectedNodeIds.push(e.id),this.forest.selectedNodeMap[e.id]=!0},removeValue(e){me(this.forest.selectedNodeIds,e.id),delete this.forest.selectedNodeMap[e.id]},removeLastValue(){if(!this.hasValue)return;if(this.single)return this.clear();const e=Ee(this.internalValue),t=this.getNode(e);this.select(t)},saveMenuScrollPosition(){const e=this.getMenu();e&&(this.menu.lastScrollPosition=e.scrollTop)},restoreMenuScrollPosition(){const e=this.getMenu();e&&(e.scrollTop=this.menu.lastScrollPosition)}},created(){this.verifyProps(),this.resetFlags()},mounted(){this.autoFocus&&this.focusInput(),!this.options&&!this.async&&this.autoLoadRootOptions&&this.loadRootOptions(),this.alwaysOpen&&this.openMenu(),this.async&&this.defaultOptions&&this.handleRemoteSearch()},unmounted(){this.toggleClickOutsideEvent(!1)}};function xn(e){return typeof e=="string"?e:e!=null&&!be(e)?JSON.stringify(e):""}const Rn=r.defineComponent({name:"vue-treeselect--hidden-fields",inject:["instance"],functional:!0,render(e){const t=e.instance;if(!t.name||t.disabled||!t.hasValue)return null;let n=t.internalValue.map(xn);return t.multiple&&t.joinValues&&(n=[n.join(t.delimiter)]),n.map((s,i)=>r.createVNode("input",{type:"hidden",name:t.name,value:s,key:"hidden-field-"+i},null))}}),An=[m.ENTER,m.END,m.HOME,m.ARROW_LEFT,m.ARROW_UP,m.ARROW_RIGHT,m.ARROW_DOWN],ze={name:"vue-treeselect--input",inject:["instance"],data:()=>({inputWidth:Re,value:""}),computed:{needAutoSize(){const{instance:e}=this;return e.searchable&&!e.disabled&&e.multiple},inputStyle(){return{width:this.needAutoSize?`${this.inputWidth}px`:null}}},watch:{"instance.trigger.searchQuery"(e){this.value=e},value(){this.needAutoSize&&this.$nextTick(this.updateInputWidth)}},created(){this.debouncedCallback=Gt(this.updateSearchQuery,Mn,{leading:!0,trailing:!0})},methods:{clear(){this.onInput({target:{value:""}})},focus(){const{instance:e}=this;e.disabled||this.$refs.input&&this.$refs.input.focus()},blur(){this.$refs.input&&this.$refs.input.blur()},onFocus(){const{instance:e}=this;e.trigger.isFocused=!0,e.openOnFocus&&e.openMenu()},onBlur(){const{instance:e}=this,t=e.getMenu();if(t&&document.activeElement===t)return this.focus();e.trigger.isFocused=!1,e.closeMenu()},onInput(e){const{value:t}=e.target;this.value=t,t?this.debouncedCallback():(this.debouncedCallback.cancel(),this.updateSearchQuery())},onKeyDown(e){const{instance:t}=this,n="which"in e?e.which:e.keyCode;if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){if(!t.menu.isOpen&&v(An,n))return e.preventDefault(),t.openMenu();switch(n){case m.BACKSPACE:{t.backspaceRemoves&&!this.value.length&&t.removeLastValue();break}case m.ENTER:{if(e.preventDefault(),t.menu.current===null)return;const s=t.getNode(t.menu.current);if(s.isBranch&&t.disableBranchNodes)return;t.select(s);break}case m.ESCAPE:{this.value.length?this.clear():t.menu.isOpen&&t.closeMenu();break}case m.END:{e.preventDefault(),t.highlightLastOption();break}case m.HOME:{e.preventDefault(),t.highlightFirstOption();break}case m.ARROW_LEFT:{const s=t.getNode(t.menu.current);s.isBranch&&t.shouldExpand(s)?(e.preventDefault(),t.toggleExpanded(s)):!s.isRootNode&&(s.isLeaf||s.isBranch&&!t.shouldExpand(s))&&(e.preventDefault(),t.setCurrentHighlightedOption(s.parentNode));break}case m.ARROW_UP:{e.preventDefault(),t.highlightPrevOption();break}case m.ARROW_RIGHT:{const s=t.getNode(t.menu.current);s.isBranch&&!t.shouldExpand(s)&&(e.preventDefault(),t.toggleExpanded(s));break}case m.ARROW_DOWN:{e.preventDefault(),t.highlightNextOption();break}case m.DELETE:{t.deleteRemoves&&!this.value.length&&t.removeLastValue();break}default:t.openMenu()}}},onMouseDown(e){this.value.length&&e.stopPropagation()},renderInputContainer(){const{instance:e}=this,t={},n=[];return e.searchable&&!e.disabled&&(n.push(this.renderInput()),this.needAutoSize&&n.push(this.renderSizer())),e.searchable||Q(t,{on:{focus:this.onFocus,blur:this.onBlur,keydown:this.onKeyDown},ref:"input"}),!e.searchable&&!e.disabled&&Q(t,{attrs:{tabIndex:e.tabIndex}}),r.createVNode("div",r.mergeProps({class:"vue-treeselect__input-container"},t),[n])},renderInput(){const{instance:e}=this;return r.createVNode("input",{ref:"input",class:"vue-treeselect__input",type:"text",autocomplete:"off",tabIndex:e.tabIndex,required:e.required&&!e.hasValue,value:this.value,style:this.inputStyle,onFocus:this.onFocus,onInput:this.onInput,onBlur:this.onBlur,onKeydown:this.onKeyDown,onMousedown:this.onMouseDown},null)},renderSizer(){return r.createVNode("div",{ref:"sizer",class:"vue-treeselect__sizer"},[this.value])},updateInputWidth(){this.inputWidth=Math.max(Re,this.$refs.sizer.scrollWidth+15)},updateSearchQuery(){const{instance:e}=this;e.trigger.searchQuery=this.value}},render(){return this.renderInputContainer()}},Fe={name:"vue-treeselect--placeholder",inject:["instance"],render(){const{instance:e}=this,t={"vue-treeselect__placeholder":!0,"vue-treeselect-helper-zoom-effect-off":!0,"vue-treeselect-helper-hide":e.hasValue||e.trigger.searchQuery};return r.createVNode("div",{class:t},[e.placeholder])}},$n={name:"vue-treeselect--single-value",inject:["instance"],methods:{renderSingleValueLabel(){const{instance:e}=this,t=e.selectedNodes[0],n=e.$slots["value-label"];return n?n({node:t}):t.label}},render(){const{instance:e,$parent:{renderValueContainer:t}}=this,n=e.hasValue&&!e.trigger.searchQuery;return t([n&&r.createVNode("div",{class:"vue-treeselect__single-value"},[this.renderSingleValueLabel()]),r.createVNode(Fe,null,null),r.createVNode(ze,{ref:"input"},null)])}},Z=(e,t)=>{const n=e.__vccOpts||e;for(const[s,i]of t)n[s]=i;return n},Bn={name:"vue-treeselect--x"},kn={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 348.333 348.333"},zn=[r.createElementVNode("path",{d:"M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"},null,-1)];function Fn(e,t,n,s,i,o){return r.openBlock(),r.createElementBlock("svg",kn,zn)}const He=Z(Bn,[["render",Fn]]),Hn={name:"vue-treeselect--multi-value-item",inject:["instance"],props:{node:{type:Object,required:!0}},methods:{handleMouseDown:L(function(){const{instance:t,node:n}=this;t.select(n)})},render(){const{instance:e,node:t}=this,n={"vue-treeselect__multi-value-item":!0,"vue-treeselect__multi-value-item-disabled":t.isDisabled,"vue-treeselect__multi-value-item-new":t.isNew},s=e.$slots["value-label"],i=s?s({node:t}):t.label;return r.createVNode("div",{class:"vue-treeselect__multi-value-item-container"},[r.createVNode("div",{class:n,onMousedown:this.handleMouseDown},[r.createVNode("span",{class:"vue-treeselect__multi-value-label"},[i]),r.createVNode("span",{class:"vue-treeselect__icon vue-treeselect__value-remove"},[r.createVNode(He,null,null)])])])}},Wn={name:"vue-treeselect--multi-value",inject:["instance"],methods:{renderMultiValueItems(){const{instance:e}=this;return e.internalValue.slice(0,e.limit).map(e.getNode).map(t=>r.createVNode(Hn,{key:`multi-value-item-${t.id}`,node:t},null))},renderExceedLimitTip(){const{instance:e}=this,t=e.internalValue.length-e.limit;return t<=0?null:r.createVNode("div",{class:"vue-treeselect__limit-tip vue-treeselect-helper-zoom-effect-off",key:"exceed-limit-tip"},[r.createVNode("span",{class:"vue-treeselect__limit-tip-text"},[e.limitText(t)])])}},render(){const{renderValueContainer:e}=this.$parent;return e(r.createVNode(r.TransitionGroup,{class:"vue-treeselect__multi-value",tag:"div",name:"vue-treeselect__multi-value-item--transition",appear:!0},{default:()=>[this.renderMultiValueItems(),this.renderExceedLimitTip(),r.createVNode(Fe,{key:"placeholder"},null),r.createVNode(ze,{ref:"input",key:"input"},null)]}))}},Pn={name:"vue-treeselect--arrow"},jn={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 292.362 292.362"},Qn=[r.createElementVNode("path",{d:"M286.935 69.377c-3.614-3.617-7.898-5.424-12.848-5.424H18.274c-4.952 0-9.233 1.807-12.85 5.424C1.807 72.998 0 77.279 0 82.228c0 4.948 1.807 9.229 5.424 12.847l127.907 127.907c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428L286.935 95.074c3.613-3.617 5.427-7.898 5.427-12.847 0-4.948-1.814-9.229-5.427-12.85z"},null,-1)];function Kn(e,t,n,s,i,o){return r.openBlock(),r.createElementBlock("svg",jn,Qn)}const We=Z(Pn,[["render",Kn]]),Un={name:"vue-treeselect--control",inject:["instance"],computed:{shouldShowX(){const{instance:e}=this;return e.clearable&&!e.disabled&&e.hasValue&&(this.hasUndisabledValue||e.allowClearingDisabled)},shouldShowArrow(){const{instance:e}=this;return e.alwaysOpen?!e.menu.isOpen:!0},hasUndisabledValue(){const{instance:e}=this;return e.hasValue&&e.internalValue.some(t=>!e.getNode(t).isDisabled)}},methods:{renderX(){const{instance:e}=this,t=e.multiple?e.clearAllText:e.clearValueText;return this.shouldShowX?r.createVNode("div",{class:"vue-treeselect__x-container",title:t,onMousedown:this.handleMouseDownOnX},[r.createVNode(He,{class:"vue-treeselect__x"},null)]):null},renderArrow(){const{instance:e}=this,t={"vue-treeselect__control-arrow":!0,"vue-treeselect__control-arrow--rotated":e.menu.isOpen};return this.shouldShowArrow?r.createVNode("div",{class:"vue-treeselect__control-arrow-container",onMousedown:this.handleMouseDownOnArrow},[r.createVNode(We,{class:t},null)]):null},handleMouseDownOnX:L(function(t){t.stopPropagation(),t.preventDefault();const{instance:n}=this,s=n.beforeClearAll(),i=o=>{o&&n.clear()};ye(s)?s.then(i):setTimeout(()=>i(s),0)}),handleMouseDownOnArrow:L(function(t){t.preventDefault(),t.stopPropagation();const{instance:n}=this;n.focusInput(),n.toggleMenu()}),renderValueContainer(e){return r.createVNode("div",{class:"vue-treeselect__value-container"},[e])}},render(){const{instance:e}=this,t=e.single?$n:Wn;return r.createVNode("div",{class:"vue-treeselect__control",onMousedown:e.handleMouseDown},[r.createVNode(t,{ref:"value-container"},null),this.renderX(),this.renderArrow()])}},y=r.defineComponent({name:"vue-treeselect--tip",functional:!0,props:{type:{type:String,required:!0},icon:{type:String,required:!0}},render(e){const{type:t,icon:n}=this;return r.createVNode("div",{class:`vue-treeselect__tip vue-treeselect__${t}-tip`},[r.createVNode("div",{class:"vue-treeselect__icon-container"},[r.createVNode("span",{class:`vue-treeselect__icon-${n}`},null)]),r.createVNode("span",{class:`vue-treeselect__tip-text vue-treeselect__${t}-tip-text`},[this.$slots.default()])])}});function qn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!r.isVNode(e)}let ee,te,ne;const Yn={name:"vue-treeselect--option",inject:["instance"],props:{node:{type:Object,required:!0}},computed:{shouldExpand(){const{instance:e,node:t}=this;return t.isBranch&&e.shouldExpand(t)},shouldShow(){const{instance:e,node:t}=this;return e.shouldShowOptionInMenu(t)}},methods:{renderOption(){const{instance:e,node:t}=this,n={"vue-treeselect__option":!0,"vue-treeselect__option--disabled":t.isDisabled,"vue-treeselect__option--selected":e.isSelected(t),"vue-treeselect__option--highlight":t.isHighlighted,"vue-treeselect__option--matched":e.localSearch.active&&t.isMatched,"vue-treeselect__option--hide":!this.shouldShow};return r.createVNode("div",{class:n,onMouseenter:this.handleMouseEnterOption,"data-id":t.id},[this.renderArrow(),this.renderLabelContainer([this.renderCheckboxContainer([this.renderCheckbox()]),this.renderLabel()])])},renderSubOptionsList(){return this.shouldExpand?r.createVNode("div",{class:"vue-treeselect__list"},[this.renderSubOptions(),this.renderNoChildrenTip(),this.renderLoadingChildrenTip(),this.renderLoadingChildrenErrorTip()]):null},renderArrow(){const{instance:e,node:t}=this;if(e.shouldFlattenOptions&&this.shouldShow)return null;if(t.isBranch){const n={"vue-treeselect__option-arrow":!0,"vue-treeselect__option-arrow--rotated":this.shouldExpand};return r.createVNode("div",{class:"vue-treeselect__option-arrow-container",onMousedown:this.handleMouseDownOnArrow},[r.createVNode(r.Transition,{name:"vue-treeselect__option-arrow--prepare",appear:!0},{default:()=>[r.createVNode(We,{class:n},null)]})])}return e.hasBranchNodes?(ee||(ee=r.createVNode("div",{class:"vue-treeselect__option-arrow-placeholder"},[r.createTextVNode(" ")])),ee):null},renderLabelContainer(e){return r.createVNode("div",{class:"vue-treeselect__label-container",onMousedown:this.handleMouseDownOnLabelContainer},[e])},renderCheckboxContainer(e){const{instance:t,node:n}=this;return t.single||t.disableBranchNodes&&n.isBranch?null:r.createVNode("div",{class:"vue-treeselect__checkbox-container"},[e])},renderCheckbox(){const{instance:e,node:t}=this,n=e.forest.checkedStateMap[t.id],s={"vue-treeselect__checkbox":!0,"vue-treeselect__checkbox--checked":n===Le,"vue-treeselect__checkbox--indeterminate":n===we,"vue-treeselect__checkbox--unchecked":n===U,"vue-treeselect__checkbox--disabled":t.isDisabled};return te||(te=r.createVNode("span",{class:"vue-treeselect__check-mark"},null)),ne||(ne=r.createVNode("span",{class:"vue-treeselect__minus-mark"},null)),r.createVNode("span",{class:s},[te,ne])},renderLabel(){const{instance:e,node:t}=this,n=t.isBranch&&(e.localSearch.active?e.showCountOnSearchComputed:e.showCount),s=n?e.localSearch.active?e.localSearch.countMap[t.id][e.showCountOf]:t.count[e.showCountOf]:NaN,i="vue-treeselect__label",o="vue-treeselect__count",a=e.$slots["option-label"];return a?a({node:t,shouldShowCount:n,count:s,labelClassName:i,countClassName:o}):r.createVNode("label",{class:i},[t.label,n&&r.createVNode("span",{class:o},[r.createTextVNode("("),s,r.createTextVNode(")")])])},renderSubOptions(){const{node:e}=this;return e.childrenStates.isLoaded?e.children.map(t=>r.createVNode(r.resolveComponent("vue-treeselect--option"),{node:t,key:t.id},null)):null},renderNoChildrenTip(){const{instance:e,node:t}=this;return!t.childrenStates.isLoaded||t.children.length?null:r.createVNode(y,{type:"no-children",icon:"warning"},{default:()=>[e.noChildrenText]})},renderLoadingChildrenTip(){const{instance:e,node:t}=this;return t.childrenStates.isLoading?r.createVNode(y,{type:"loading",icon:"loader"},{default:()=>[e.loadingText]}):null},renderLoadingChildrenErrorTip(){const{instance:e,node:t}=this;return t.childrenStates.loadingError?r.createVNode(y,{type:"error",icon:"error"},{default:()=>[t.childrenStates.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",title:e.retryTitle,onMousedown:this.handleMouseDownOnRetry},[e.retryText])]}):null},handleMouseEnterOption(e){const{instance:t,node:n}=this;e.target===e.currentTarget&&t.setCurrentHighlightedOption(n,!1)},handleMouseDownOnArrow:L(function(){const{instance:t,node:n}=this;t.toggleExpanded(n)}),handleMouseDownOnLabelContainer:L(function(){const{instance:t,node:n}=this;n.isBranch&&t.disableBranchNodes?t.toggleExpanded(n):t.select(n)}),handleMouseDownOnRetry:L(function(){const{instance:t,node:n}=this;t.loadChildrenOptions(n)})},render(){let e;const{node:t}=this,s={"vue-treeselect__list-item":!0,[`vue-treeselect__indent-level-${this.instance.shouldFlattenOptions?0:t.level}`]:!0};return r.createVNode("div",{class:s},[this.renderOption(),t.isBranch?r.createVNode(r.Transition,{name:"vue-treeselect__list--transition"},qn(e=this.renderSubOptionsList())?e:{default:()=>[e]}):""])}};function Xn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!r.isVNode(e)}const Gn={top:"top",bottom:"bottom",above:"top",below:"bottom"},Pe={name:"vue-treeselect--menu",inject:["instance"],computed:{menuStyle(){const{instance:e}=this;return{maxHeight:e.maxHeight+"px"}},menuContainerStyle(){const{instance:e}=this;return{zIndex:e.appendToBody?null:e.zIndex}}},watch:{"instance.menu.isOpen"(e){e?this.$nextTick(this.onMenuOpen):this.onMenuClose()}},created(){this.menuSizeWatcher=null,this.menuResizeAndScrollEventListeners=null},mounted(){const{instance:e}=this;e.menu.isOpen&&this.$nextTick(this.onMenuOpen)},unmounted(){this.onMenuClose()},methods:{renderMenu(){const{instance:e}=this;return e.menu.isOpen?r.createVNode("div",{ref:"menu",class:"vue-treeselect__menu",onMousedown:e.handleMouseDown,style:this.menuStyle},[this.renderBeforeList(),e.async?this.renderAsyncSearchMenuInner():e.localSearch.active?this.renderLocalSearchMenuInner():this.renderNormalMenuInner(),this.renderAfterList()]):null},renderBeforeList(){const{instance:e}=this,t=e.$slots["before-list"];return t?t():null},renderAfterList(){const{instance:e}=this,t=e.$slots["after-list"];return t?t():null},renderNormalMenuInner(){const{instance:e}=this;return e.rootOptionsStates.isLoading?this.renderLoadingOptionsTip():e.rootOptionsStates.loadingError?this.renderLoadingRootOptionsErrorTip():e.rootOptionsStates.isLoaded&&e.forest.normalizedOptions.length===0?this.renderNoAvailableOptionsTip():this.renderOptionList()},renderLocalSearchMenuInner(){const{instance:e}=this;return e.rootOptionsStates.isLoading?this.renderLoadingOptionsTip():e.rootOptionsStates.loadingError?this.renderLoadingRootOptionsErrorTip():e.rootOptionsStates.isLoaded&&e.forest.normalizedOptions.length===0?this.renderNoAvailableOptionsTip():e.localSearch.noResults?this.renderNoResultsTip():this.renderOptionList()},renderAsyncSearchMenuInner(){const{instance:e}=this,t=e.getRemoteSearchEntry(),n=e.trigger.searchQuery===""&&!e.defaultOptions,s=n?!1:t.isLoaded&&t.options.length===0;return n?this.renderSearchPromptTip():t.isLoading?this.renderLoadingOptionsTip():t.loadingError?this.renderAsyncSearchLoadingErrorTip():s?this.renderNoResultsTip():this.renderOptionList()},renderOptionList(){const{instance:e}=this;return r.createVNode("div",{class:"vue-treeselect__list"},[e.forest.normalizedOptions.map(t=>r.createVNode(Yn,{node:t,key:t.id},null))])},renderSearchPromptTip(){const{instance:e}=this;return r.createVNode(y,{type:"search-prompt",icon:"warning"},{default:()=>[e.searchPromptText]})},renderLoadingOptionsTip(){const{instance:e}=this;return r.createVNode(y,{type:"loading",icon:"loader"},{default:()=>[e.loadingText]})},renderLoadingRootOptionsErrorTip(){const{instance:e}=this;return r.createVNode(y,{type:"error",icon:"error"},{default:()=>[e.rootOptionsStates.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",onClick:e.loadRootOptions,title:e.retryTitle},[e.retryText])]})},renderAsyncSearchLoadingErrorTip(){const{instance:e}=this,t=e.getRemoteSearchEntry();return r.createVNode(y,{type:"error",icon:"error"},{default:()=>[t.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",onClick:e.handleRemoteSearch,title:e.retryTitle},[e.retryText])]})},renderNoAvailableOptionsTip(){const{instance:e}=this;return r.createVNode(y,{type:"no-options",icon:"warning"},{default:()=>[e.noOptionsText]})},renderNoResultsTip(){const{instance:e}=this;return r.createVNode(y,{type:"no-results",icon:"warning"},{default:()=>[e.noResultsText]})},onMenuOpen(){this.adjustMenuOpenDirection(),this.setupMenuSizeWatcher(),this.setupMenuResizeAndScrollEventListeners()},onMenuClose(){this.removeMenuSizeWatcher(),this.removeMenuResizeAndScrollEventListeners()},adjustMenuOpenDirection(){const{instance:e}=this;if(!e.menu.isOpen)return;const t=e.getMenu(),n=e.getControl(),s=t.getBoundingClientRect(),i=n.getBoundingClientRect(),o=s.height,a=window.innerHeight,c=i.top,u=window.innerHeight-i.bottom,d=i.top>=0&&i.top<=a||i.top<0&&i.bottom>0,g=u>o+Ae,h=c>o+Ae;d?e.openDirection!=="auto"?e.menu.placement=Gn[e.openDirection]:g||!h?e.menu.placement="bottom":e.menu.placement="top":e.closeMenu()},setupMenuSizeWatcher(){const{instance:e}=this,t=e.getMenu();this.menuSizeWatcher||(this.menuSizeWatcher={remove:Se(t,this.adjustMenuOpenDirection)})},setupMenuResizeAndScrollEventListeners(){const{instance:e}=this,t=e.getControl();this.menuResizeAndScrollEventListeners||(this.menuResizeAndScrollEventListeners={remove:Oe(t,this.adjustMenuOpenDirection)})},removeMenuSizeWatcher(){this.menuSizeWatcher&&(this.menuSizeWatcher.remove(),this.menuSizeWatcher=null)},removeMenuResizeAndScrollEventListeners(){this.menuResizeAndScrollEventListeners&&(this.menuResizeAndScrollEventListeners.remove(),this.menuResizeAndScrollEventListeners=null)}},render(){let e;return r.createVNode("div",{ref:"menu-container",class:"vue-treeselect__menu-container",style:this.menuContainerStyle},[r.createVNode(r.Transition,{name:"vue-treeselect__menu--transition"},Xn(e=this.renderMenu())?e:{default:()=>[e]})])}},Jn={name:"vue-treeselect--portal-target",inject:["instance"],watch:{"instance.menu.isOpen"(e){e?this.setupHandlers():this.removeHandlers()},"instance.menu.placement"(){this.updateMenuContainerOffset()}},created(){this.controlResizeAndScrollEventListeners=null,this.controlSizeWatcher=null},mounted(){const{instance:e}=this;e.menu.isOpen&&this.setupHandlers()},methods:{setupHandlers(){this.updateWidth(),this.updateMenuContainerOffset(),this.setupControlResizeAndScrollEventListeners(),this.setupControlSizeWatcher()},removeHandlers(){this.removeControlResizeAndScrollEventListeners(),this.removeControlSizeWatcher()},setupControlResizeAndScrollEventListeners(){const{instance:e}=this,t=e.getControl();this.controlResizeAndScrollEventListeners||(this.controlResizeAndScrollEventListeners={remove:Oe(t,this.updateMenuContainerOffset)})},setupControlSizeWatcher(){const{instance:e}=this,t=e.getControl();this.controlSizeWatcher||(this.controlSizeWatcher={remove:Se(t,()=>{this.updateWidth(),this.updateMenuContainerOffset()})})},removeControlResizeAndScrollEventListeners(){this.controlResizeAndScrollEventListeners&&(this.controlResizeAndScrollEventListeners.remove(),this.controlResizeAndScrollEventListeners=null)},removeControlSizeWatcher(){this.controlSizeWatcher&&(this.controlSizeWatcher.remove(),this.controlSizeWatcher=null)},updateWidth(){const{instance:e}=this,t=this.$el,s=e.getControl().getBoundingClientRect();t.style.width=s.width+"px"},updateMenuContainerOffset(){const{instance:e}=this,t=e.getControl(),n=this.$el,s=t.getBoundingClientRect(),i=n.getBoundingClientRect(),o=e.menu.placement==="bottom"?s.height:0,a=Math.round(s.left-i.left)+"px",c=Math.round(s.top-i.top+o)+"px",u=this.$refs.menu.$refs["menu-container"].style,g=Ce(["transform","webkitTransform","MozTransform","msTransform"],h=>h in document.body.style);u[g]=`translate(${a}, ${c})`}},render(){const{instance:e}=this,t=["vue-treeselect__portal-target",e.wrapperClass],n={zIndex:e.zIndex};return r.createVNode("div",{class:t,style:n,"data-instance-id":e.getInstanceId()},[r.createVNode(Pe,{ref:"menu"},null)])},unmounted(){this.removeHandlers()}};let se;const Zn={name:"vue-treeselect--menu-portal",created(){this.portalTarget=null},mounted(){this.setup()},unmounted(){this.teardown()},methods:{setup(){const e=document.createElement("div");document.body.appendChild(e),this.portalTarget=r.createApp({parent:this,...Jn}),this.portalTarget.mount(e)},teardown(){document.body.removeChild(this.portalTarget.$el),this.portalTarget.$el.innerHTML="",this.portalTarget.$destroy(),this.portalTarget=null}},render(){return se||(se=r.createVNode("div",{class:"vue-treeselect__menu-placeholder"},null)),se}},es=r.defineComponent({name:"vue-treeselect",mixins:[ke],components:{HiddenFields:Rn,Control:Un,Menu:Pe,MenuPortal:Zn},computed:{wrapperClass(){return{"vue-treeselect":!0,"vue-treeselect--single":this.single,"vue-treeselect--multi":this.multiple,"vue-treeselect--searchable":this.searchable,"vue-treeselect--disabled":this.disabled,"vue-treeselect--focused":this.trigger.isFocused,"vue-treeselect--has-value":this.hasValue,"vue-treeselect--open":this.menu.isOpen,"vue-treeselect--open-above":this.menu.placement==="top","vue-treeselect--open-below":this.menu.placement==="bottom","vue-treeselect--branch-nodes-disabled":this.disableBranchNodes,"vue-treeselect--append-to-body":this.appendToBody}}}});function ts(e,t,n,s,i,o){const a=r.resolveComponent("HiddenFields"),c=r.resolveComponent("Control"),u=r.resolveComponent("MenuPortal"),d=r.resolveComponent("Menu");return r.openBlock(),r.createElementBlock("div",{ref:"wrapper",class:r.normalizeClass(e.wrapperClass)},[r.createVNode(a),r.createVNode(c,{ref:"control"},null,512),e.appendToBody?(r.openBlock(),r.createBlock(u,{key:0,ref:"portal"},null,512)):(r.openBlock(),r.createBlock(d,{key:1,ref:"menu"},null,512))],2)}const je=Z(es,[["render",ts]]);S.ASYNC_SEARCH=Ve,S.LOAD_CHILDREN_OPTIONS=Me,S.LOAD_ROOT_OPTIONS=Te,S.Treeselect=je,S.default=je,S.treeselectMixin=ke,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
